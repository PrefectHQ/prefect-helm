---
# Example values for deploying prefect-server with Gateway API
# This example demonstrates:
# - Gateway API with HTTPS and TLS
# - Automatic HTTP to HTTPS redirect
# - Custom hostnames and paths
# - TLS certificate configuration

# Disable Ingress (Gateway and Ingress are mutually exclusive)
ingress:
  enabled: false

# Enable and configure Gateway API
gateway:
  enabled: true
  
  # GatewayClass name - must exist in your cluster
  # Common values: "istio", "envoy", "nginx", etc.
  className: "istio"
  
  # Optional: Custom Gateway name (defaults to release fullname)
  # name: "my-custom-gateway"
  
  # Optional: Add custom labels to the Gateway resource
  labels:
    environment: production
    team: platform
  
  # Optional: Add custom annotations to the Gateway resource
  annotations:
    external-dns.alpha.kubernetes.io/hostname: "prefect.example.com"
  
  # Gateway listeners configuration
  listeners:
    # HTTP listener on port 80
    - name: http
      port: 80
      protocol: HTTP
      hostname: ""
    
    # HTTPS listener on port 443
    - name: https
      port: 443
      protocol: HTTPS
      hostname: ""
      tls:
        mode: Terminate
        certificateRefs:
          - kind: Secret
            # TLS certificate Secret name
            # The secret should contain tls.crt and tls.key
            name: "prefect-tls-cert"
            # Optional: specify namespace if secret is in a different namespace
            # namespace: "cert-manager"

# HTTPRoute configuration
httproute:
  # HTTPRoute is enabled by default when gateway.enabled=true
  enabled: true
  
  # Optional: Custom HTTPRoute name (defaults to release fullname)
  # name: "my-custom-httproute"
  
  # Hostnames that this HTTPRoute should match
  hostnames:
    - "prefect.example.com"
    # Optional: Add additional hostnames
    # - "prefect-alt.example.com"
  
  # Parent Gateway references
  # Defaults shown below - usually you don't need to override these
  parentRefs:
    - name: ""  # Defaults to gateway.name
      namespace: ""  # Defaults to release namespace
      sectionName: https  # Which listener to attach to
      port: null  # Optional: specify port if needed
  
  # Optional: Add custom labels to the HTTPRoute resource
  labels:
    app: prefect
  
  # Optional: Add custom annotations to the HTTPRoute resource
  annotations:
    custom-annotation: value
  
  # TLS redirect configuration
  tls:
    # Enable automatic HTTP to HTTPS redirect
    redirect: true
    # HTTPS port for redirect (defaults to 443)
    redirectPort: 443

# Server configuration
server:
  # Configure the Prefect UI API URL
  # This should match your Gateway hostname
  uiConfig:
    prefectUiApiUrl: "https://prefect.example.com/api"

# Service configuration
service:
  type: ClusterIP
  port: 4200

# Database configuration
postgresql:
  enabled: true
  auth:
    username: prefect
    password: prefect-password
    database: prefect

# Redis configuration (required for background services)
redis:
  enabled: true
